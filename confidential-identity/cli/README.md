# Confidential Identity Library

## Simple Claim Prover

CDD Claims and Scope Claims are types of claims that can be attached to an investor's identity on the PolyMesh.
CDD claims are registered by a trusted CDD provider using [cdd-register-did][cdd-register-did] API, and Scope
claims are created and added to the chain by the investor using [add_claim][add-claim] API.

CDD claims are generated by a PolyMesh trusted CDD provider during the CDD process (see
[cdd-register-did][cdd-register-did]), and privately link an investor's unique id (`investor_unique_id`, which
is kept secret between the investor and CDD provider) to their on-chain identity (`investor_did`, the serialized
[IdentityId][IdentityId] of the investor). In order to achieve this, the CDD provider has to generate a CDD Id,
include it in their claim, and submit it to the PolyMesh chain.
Note that every time an investor requests a new identity from a CDD provider, the same unique identity (which is
obtained from the Polymath Unique Identity System (PUIS)) must be used to create the CDD claim, even though the
investor's DID will be different. A CDD claim can be inputted to the `polymath-scp` CommandLine Interface (CLI)
in JSON format. Let's assume it is saved as `my_cdd_claim.json`:
```
{
  "investor_did":[32_bytes_array],
  "investor_unique_id":[16_bytes_array]
}
```

Scope Claims are generated by the investors and reference a specific scope (e.g. asset); see [add_claim][add-claim].
The investor must generate this claim for each identity that they wish to use to invest in a particular asset
(i.e. scope). Currently `scope_did` is set to be the asset's ticker name (a 12 bytes string, e.g. `AAPL`).
Let's assume this structure is saved as `my_scope_claim.json`:
```
{
  "scope_did":[12_bytes_array],
  "investor_unique_id":[16_bytes_array]
}
```

### CDD Provider Usage
Given the `my_cdd_claim.json` file, a CDD provider can use the `polymath-scp` CLI with the `create-cdd-id` sub-command
to create the CDD Id that they can later bundle as a claim and save on Polymesh.

### Investors' Usage

Given these 2 files, the investor can use the `polymath-scp` CLI with the `create-claim-proof` sub-command to generate
a confidential proof which PolyMesh will later use to verify the integrity of scope claim as well as aggregate all
investments made by identities that share the same unique identifier (`investor_unique_id`) without having the knowledge
of the unique id.

## Simple Claim Verifier
The `polymath-scv` CLI can be used to verify an investor's claim proof the same way that the PolyMesh would do.
Note that this verification does not apply to the CDD Id that the CDD Provider generates.

## Build the CLIs

```bash
cargo +nightly build --release
```

The two CLIs (`polymath-scp` and `polymath-scv`) are placed in `cryptography/target/release`. You can
call them by adding `cryptography/target/release` to your `PATH` environment variable,
or call them using the absolute path to the CLI file.

## Run the CLIs
### CDD Provider Usage
To create the CDD Id using the prover CLI:
```bash
polymath-scp create-cdd-id -v --cdd-claim my_cdd_claim.json
```
For your convenience we have provided an optional flag (`-r` or `--rand`) to randomly generate the inputted JSON file:
```bash
polymath-scp create-cdd-id -v -r --cdd-claim rand_cdd_claim.json
```
You can optionally save the resulting CDD Id to file, if you pass in the `cdd-id` with a file name:
```bash
polymath-scp create-cdd-id -v --cdd-claim my_cdd_claim.json --cdd-id my_cdd_id.json
```
To see the usage for this sub-command, run:
```bash
polymath-scp create-cdd-id -h
```

### Investors' Usage
To run Claim prover CLI:
```bash
polymath-scp create-claim-proof -v --cdd-claim my_cdd_claim.json --scope-claim my_scope_claim.json --proof proof.json
```
For your convenience we have provided an optional flag (`-r` or `--rand`) to randomly generate the inputted JSON file.
```bash
polymath-scp create-claim-proof -v -r --cdd-claim rand_cdd_claim.json --scope-claim rand_scope_claim.json --proof proof.json
```
This command will generate a random CDD claim as well as a random scope claim and save them into separate JSON files.
From these claims it will generate a proof of possession of the unique id and save it to `proof.json`.

To see the usage for this sub-command, run:
```bash
polymath-scp create-claim-proof -h
```

To run the Claim verifier CLI:

```bash
polymath-scv --proof proof.json
```

It will determine whether `proof.json` is a valid proof of possession of the unique ID.
To learn more about the usage, run:

```bash
polymath-scv -h
```

[cdd-register-did]: https://docs.polymesh.live/pallet_identity/enum.Call.html#variant.cdd_register_did
[IdentityId]: https://docs.polymesh.live/polymesh_primitives/identity_id/struct.IdentityId.html
[add-claim]: https://docs.polymesh.live/pallet_identity/enum.Call.html#variant.add_claim
